<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Airport Visit Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #2D728F 0%, #3B8EA5 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        h1 {
            color: white;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.1em;
        }

        .nav-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
        }

        .nav-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .nav-btn.active {
            background: rgba(255, 255, 255, 0.4);
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }

        .content-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            display: none;
        }

        .content-section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { 
                opacity: 0; 
                transform: translateY(20px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }

        .home-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #F49E4C 0%, #AB3428 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .airport-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .airport-card {
            background: #F5EE9E;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border-left: 4px solid #2D728F;
        }

        .airport-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .airport-code {
            font-size: 1.8em;
            font-weight: bold;
            color: #2D728F;
            margin-bottom: 5px;
        }

        .airport-name {
            font-size: 1.1em;
            color: #666;
            margin-bottom: 15px;
        }

        .airport-location {
            font-size: 1em;
            color: #666;
            margin-bottom: 15px;
        }

        .rating {
            display: flex;
            gap: 2px;
            margin-bottom: 10px;
        }

        .star {
            color: #F49E4C;
            font-size: 1.2em;
        }

        .star.empty {
            color: #ddd;
        }

        .visit-date {
            font-size: 0.9em;
            color: #888;
            margin-bottom: 10px;
        }

        .comments {
            font-style: italic;
            color: #666;
            line-height: 1.4;
            margin-bottom: 15px;
        }

        .card-actions {
            margin-top: 15px;
        }

        .delete-btn {
            background: #AB3428;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s ease;
        }

        .delete-btn:hover {
            background: #8b2820;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #2D728F;
            box-shadow: 0 0 0 3px rgba(45, 114, 143, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .rating-input {
            display: flex;
            gap: 5px;
            align-items: center;
        }

        .rating-star {
            font-size: 1.5em;
            color: #ddd;
            cursor: pointer;
            transition: color 0.2s ease;
            user-select: none;
        }

        .rating-star:hover,
        .rating-star.active {
            color: #F49E4C;
        }

        .submit-btn {
            background: linear-gradient(135deg, #F49E4C 0%, #AB3428 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(244, 158, 76, 0.3);
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(244, 158, 76, 0.4);
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .empty-state h3 {
            margin-bottom: 10px;
            color: #888;
        }

        @media (max-width: 768px) {
            .nav-buttons {
                flex-direction: column;
                align-items: center;
            }

            .nav-btn {
                width: 200px;
            }

            .airport-grid {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>✈️ Airport Visit Tracker</h1>
            <p class="subtitle">Keep track of all the airports you've visited around the world</p>
        </header>

        <div class="nav-buttons">
            <button class="nav-btn active" data-section="home">Home</button>
            <button class="nav-btn" data-section="grid">Airport Grid</button>
            <button class="nav-btn" data-section="add">Add Visit</button>
        </div>

        <!-- Home Section -->
        <div id="home" class="content-section active">
            <div class="home-stats">
                <div class="stat-card">
                    <div class="stat-number" id="totalAirports">0</div>
                    <div class="stat-label">Airports Visited</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="avgRating">0.0</div>
                    <div class="stat-label">Average Rating</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="topRated">-</div>
                    <div class="stat-label">Top Rated</div>
                </div>
            </div>
            
            <h2>Welcome to your Airport Visit Tracker!</h2>
            <p>Use this app to keep track of all the airports you've visited, rate your experiences, and add personal notes about each visit. Navigate to the Airport Grid to see all your visits, or use Add Visit to log a new airport.</p>
        </div>

        <!-- Grid Section -->
        <div id="grid" class="content-section">
            <h2>Your Airport Visits</h2>
            <div id="airportGrid" class="airport-grid">
                <div class="empty-state">
                    <h3>No airports visited yet</h3>
                    <p>Start by adding your first airport visit!</p>
                </div>
            </div>
        </div>

        <!-- Add Visit Section -->
        <div id="add" class="content-section">
            <h2>Add New Airport Visit</h2>
            <form id="airportForm">
                <div class="form-group">
                    <label for="airportCode">Airport Code (e.g., JFK, LAX, LHR)</label>
                    <input type="text" id="airportCode" maxlength="4" style="text-transform: uppercase;" required>
                </div>

                <div class="form-group">
                    <label for="airportName">Airport Name</label>
                    <input type="text" id="airportName" placeholder="John F. Kennedy International Airport" required>
                </div>

                <div class="form-group">
                    <label for="city">City</label>
                    <input type="text" id="city" placeholder="New York" required>
                </div>

                <div class="form-group">
                    <label for="country">Country</label>
                    <input type="text" id="country" placeholder="United States" required>
                </div>

                <div class="form-group">
                    <label for="visitDate">Visit Date</label>
                    <input type="date" id="visitDate" required>
                </div>

                <div class="form-group">
                    <label>Rating (1-5 stars)</label>
                    <div class="rating-input" id="ratingInput">
                        <span class="rating-star" data-rating="1">★</span>
                        <span class="rating-star" data-rating="2">★</span>
                        <span class="rating-star" data-rating="3">★</span>
                        <span class="rating-star" data-rating="4">★</span>
                        <span class="rating-star" data-rating="5">★</span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="comments">Comments</label>
                    <textarea id="comments" placeholder="Share your thoughts about this airport..."></textarea>
                </div>

                <button type="submit" class="submit-btn">Add Airport Visit</button>
            </form>
        </div>
    </div>

    <script>
        // API configuration
        const API_BASE_URL = 'http://localhost:3000/api';
        
        let airportData = [];
        let currentRating = 0;

        // API functions
        async function fetchAirports() {
            try {
                const response = await fetch(`${API_BASE_URL}/airports`);
                if (!response.ok) throw new Error('Failed to fetch airports');
                airportData = await response.json();
                return airportData;
            } catch (error) {
                console.error('Error fetching airports:', error);
                // Fallback to sample data for demo purposes
                airportData = [
                    {
                        id: 1,
                        code: 'JFK',
                        name: 'John F. Kennedy International Airport',
                        city: 'New York',
                        country: 'United States',
                        visitDate: '2023-06-15',
                        rating: 4,
                        comments: 'Great international terminal, but can be crowded. Good shopping and dining options.'
                    },
                    {
                        id: 2,
                        code: 'LHR',
                        name: 'London Heathrow Airport',
                        city: 'London',
                        country: 'United Kingdom',
                        visitDate: '2023-07-22',
                        rating: 5,
                        comments: 'Excellent airport with efficient operations. Terminal 5 is particularly impressive.'
                    },
                    {
                        id: 3,
                        code: 'NRT',
                        name: 'Narita International Airport',
                        city: 'Tokyo',
                        country: 'Japan',
                        rating: 5,
                        visitDate: '2023-09-10',
                        comments: 'Incredibly clean and organized. Amazing attention to detail and service.'
                    }
                ];
                showNotification('Using offline mode - start the server to save data persistently', 'warning');
                return airportData;
            }
        }

        async function addAirport(airportData) {
            try {
                const response = await fetch(`${API_BASE_URL}/airports`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(airportData)
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Failed to add airport');
                }
                
                return await response.json();
            } catch (error) {
                throw error;
            }
        }

        async function deleteAirport(id) {
            try {
                const response = await fetch(`${API_BASE_URL}/airports/${id}`, {
                    method: 'DELETE'
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Failed to delete airport');
                }
                
                return await response.json();
            } catch (error) {
                throw error;
            }
        }

        async function fetchStats() {
            try {
                const response = await fetch(`${API_BASE_URL}/stats`);
                if (!response.ok) throw new Error('Failed to fetch stats');
                return await response.json();
            } catch (error) {
                console.error('Error fetching stats:', error);
                // Calculate stats from local data
                const totalAirports = airportData.length;
                const avgRating = totalAirports > 0 ? 
                    (airportData.reduce((sum, airport) => sum + airport.rating, 0) / totalAirports).toFixed(1) : 
                    '0.0';
                
                const topRatedAirport = airportData.length > 0 ? 
                    airportData.reduce((top, airport) => 
                        airport.rating > top.rating ? airport : top
                    ) : null;

                return {
                    totalAirports,
                    averageRating: avgRating,
                    topRatedAirport,
                    countriesVisited: [...new Set(airportData.map(a => a.country))].length
                };
            }
        }

        // UI helper functions
        function showNotification(message, type = 'success') {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 8px;
                color: white;
                font-weight: bold;
                z-index: 1000;
                animation: slideIn 0.3s ease;
                max-width: 300px;
                word-wrap: break-word;
            `;
            
            if (type === 'success') {
                notification.style.background = 'linear-gradient(135deg, #F49E4C 0%, #AB3428 100%)';
            } else if (type === 'warning') {
                notification.style.background = 'linear-gradient(135deg, #F5EE9E 0%, #F49E4C 100%)';
                notification.style.color = '#333';
            } else if (type === 'error') {
                notification.style.background = 'linear-gradient(135deg, #AB3428 0%, #2D728F 100%)';
            }
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // Add slide-in animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
            `;
            document.head.appendChild(style);
            
            // Remove notification after 4 seconds
            setTimeout(() => {
                notification.remove();
            }, 4000);
        }

        // Navigation functionality
        document.addEventListener('DOMContentLoaded', async function() {
            const navBtns = document.querySelectorAll('.nav-btn');
            const sections = document.querySelectorAll('.content-section');

            // Load initial data
            await fetchAirports();
            await updateHomeStats();
            renderAirportGrid();

            navBtns.forEach(btn => {
                btn.addEventListener('click', async () => {
                    const targetSection = btn.dataset.section;
                    
                    // Update active nav button
                    navBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    // Show target section
                    sections.forEach(section => {
                        section.classList.remove('active');
                        if (section.id === targetSection) {
                            section.classList.add('active');
                        }
                    });

                    // Update content when switching to grid or home
                    if (targetSection === 'grid') {
                        await fetchAirports();
                        renderAirportGrid();
                    } else if (targetSection === 'home') {
                        await updateHomeStats();
                    }
                });
            });

            // Rating input functionality
            const ratingStars = document.querySelectorAll('.rating-star');
            ratingStars.forEach((star, index) => {
                star.addEventListener('click', () => {
                    currentRating = parseInt(star.dataset.rating);
                    updateRatingDisplay();
                });

                star.addEventListener('mouseover', () => {
                    const hoverRating = parseInt(star.dataset.rating);
                    ratingStars.forEach((s, i) => {
                        s.classList.toggle('active', i < hoverRating);
                    });
                });
            });

            document.getElementById('ratingInput').addEventListener('mouseleave', updateRatingDisplay);

            // Form submission
            document.getElementById('airportForm').addEventListener('submit', handleFormSubmit);

            // Auto-uppercase airport code input
            document.getElementById('airportCode').addEventListener('input', function(e) {
                e.target.value = e.target.value.toUpperCase();
            });
        });

        function updateRatingDisplay() {
            const ratingStars = document.querySelectorAll('.rating-star');
            ratingStars.forEach((star, index) => {
                star.classList.toggle('active', index < currentRating);
            });
        }

        async function handleFormSubmit(e) {
            e.preventDefault();
            
            const formData = {
                code: document.getElementById('airportCode').value.toUpperCase(),
                name: document.getElementById('airportName').value,
                city: document.getElementById('city').value,
                country: document.getElementById('country').value,
                visitDate: document.getElementById('visitDate').value,
                rating: currentRating,
                comments: document.getElementById('comments').value
            };

            if (currentRating === 0) {
                showNotification('Please select a rating!', 'error');
                return;
            }

            try {
                // Try to add to backend
                await addAirport(formData);
                
                // Reset form
                document.getElementById('airportForm').reset();
                currentRating = 0;
                updateRatingDisplay();
                
                // Show success message and switch to grid view
                showNotification('Airport visit added successfully!', 'success');
                
                // Refresh data and switch to grid view
                await fetchAirports();
                document.querySelector('.nav-btn[data-section="grid"]').click();
                
            } catch (error) {
                showNotification(error.message, 'error');
            }
        }

        function renderAirportGrid() {
            const gridContainer = document.getElementById('airportGrid');
            
            if (airportData.length === 0) {
                gridContainer.innerHTML = `
                    <div class="empty-state">
                        <h3>No airports visited yet</h3>
                        <p>Start by adding your first airport visit!</p>
                    </div>
                `;
                return;
            }

            // Sort by visit date (most recent first)
            const sortedData = [...airportData].sort((a, b) => new Date(b.visitDate) - new Date(a.visitDate));

            gridContainer.innerHTML = sortedData.map(airport => `
                <div class="airport-card">
                    <div class="airport-code">${airport.code}</div>
                    <div class="airport-name">${airport.name}</div>
                    <div class="airport-location">${airport.city}, ${airport.country}</div>
                    <div class="rating">
                        ${Array.from({length: 5}, (_, i) => 
                            `<span class="star ${i < airport.rating ? '' : 'empty'}">★</span>`
                        ).join('')}
                    </div>
                    <div class="visit-date">Visited: ${formatDate(airport.visitDate)}</div>
                    ${airport.comments ? `<div class="comments">"${airport.comments}"</div>` : ''}
                    <div class="card-actions">
                        <button onclick="deleteAirportVisit(${airport.id})" class="delete-btn">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        async function deleteAirportVisit(id) {
            if (confirm('Are you sure you want to delete this airport visit?')) {
                try {
                    await deleteAirport(id);
                    showNotification('Airport visit deleted successfully!', 'success');
                    await fetchAirports();
                    renderAirportGrid();
                    await updateHomeStats();
                } catch (error) {
                    showNotification(error.message, 'error');
                }
            }
        }

        async function updateHomeStats() {
            try {
                const stats = await fetchStats();
                
                document.getElementById('totalAirports').textContent = stats.totalAirports;
                document.getElementById('avgRating').textContent = stats.averageRating;
                document.getElementById('topRated').textContent = stats.topRatedAirport ? stats.topRatedAirport.code : '-';
            } catch (error) {
                console.error('Error updating stats:', error);
            }
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
        }
    </script>
</body>
</html>